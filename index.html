<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Painel de Reservas - CARNEIRO MERCATTO</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f4f4f4; }
    header { background: #2196F3; color: #fff; display: flex; justify-content: space-between; align-items: center; padding: 20px; flex-wrap: wrap; }
    header img { height: 50px; }
    .container { display: flex; flex-wrap: wrap; }
    nav { background: #333; color: #fff; width: 200px; height: 100vh; padding: 20px; box-sizing: border-box; }
    nav h3 { margin-top: 0; }
    nav a { color: #fff; display: block; margin: 10px 0; text-decoration: none; cursor: pointer; }
    nav a.active { font-weight: bold; text-decoration: underline; }
    .content { flex: 1; padding: 20px; }
    .eye-global { cursor: pointer; font-size: 20px; margin-bottom: 10px; display: inline-block; }
    .filters { margin-bottom: 20px; }
    .filters label { margin-right: 10px; }
    .cards { display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; }
    .card { background: #fff; padding: 20px; flex: 1; border-radius: 8px; box-shadow: 0 0 8px rgba(0,0,0,0.1); text-align: center; }
    table { width: 100%; border-collapse: collapse; background: #fff; }
    th, td { padding: 10px; border: 1px solid #ddd; text-align: center; }
    .btn { padding: 6px 12px; border: none; cursor: pointer; border-radius: 4px; }
    .btn-edit { background: #ffc107; color: #000; }
    .btn-liquidar { background: #4CAF50; color: #fff; }
    .btn-reabrir { background: #f44336; color: #fff; }
    .form-panel { background: #fff; padding: 20px; margin-bottom: 20px; border-radius: 8px; }
    .form-row { display: flex; gap: 20px; flex-wrap: wrap; }
    .form-group { flex: 1; min-width: 200px; }
    label { display: block; margin: 4px 0; }
    input, select, textarea { width: 100%; padding: 8px; margin-bottom: 10px; }
    .checkbox-group { display: flex; align-items: center; justify-content: flex-end; gap: 8px; margin: 10px 0; }
    #valorAntecipadoDiv { display: none; margin-top: 10px; }
    button { background: #2196F3; color: #fff; border: none; padding: 10px 20px; cursor: pointer; border-radius: 4px; }
    @media (max-width: 768px) { .container { flex-direction: column; } nav { width: 100%; height: auto; } .cards { flex-direction: column; } .form-row { flex-direction: column; } .form-group { min-width: 100%; } header { flex-direction: column; text-align: center; } }
  </style>
</head>
<body>

<header>
  <h1>Painel de Reservas - CARNEIRO MERCATTO</h1>
  <img src="https://static.wixstatic.com/media/d830b0_207a7b09d8f24ebc97b887c3d4d18691~mv2.png" alt="Logo" />
</header>

<div class="container">
  <nav>
    <h3>Menu</h3>
    <a id="link-dashboard" class="active" onclick="showSection('dashboard')">Dashboard</a>
    <a id="link-reserva" onclick="showSection('reserva')">Nova Reserva</a>
  </nav>

  <div class="content">
    <!-- DASHBOARD -->
    <div id="dashboard">
      <span class="eye-global" onclick="toggleAll()">Mostrar/Esconder Totais</span>
      <div class="filters">
        <label>Data Inicial: <input type="date" id="filtroDataInicial"></label>
        <label>Data Final: <input type="date" id="filtroDataFinal"></label>
        <label>Status:
          <select id="filtroStatus">
            <option value="">Todos</option>
            <option value="Pendente">Pendente</option>
            <option value="Concluída">Concluída</option>
          </select>
        </label>
        <button onclick="listarReservas()">Aplicar Filtros</button>
      </div>
      <div class="cards">
        <div class="card"><h3>Total Reservas Hoje</h3><p id="totalReservas">••••••</p></div>
        <div class="card"><h3>Reservas Futuras</h3><p id="totalFuturas">••••••</p></div>
        <div class="card"><h3>Total Geral</h3><p id="totalGeral">••••••</p></div>
      </div>
      <div class="cards">
        <div class="card"><h3>Pagamentos Antecipados</h3><p id="totalAntecipado">••••••</p></div>
        <div class="card"><h3>Valor Estimado (a receber)</h3><p id="valorTotal">••••••</p></div>
        <div class="card"><h3>Valor Total Bruto</h3><p id="valorBruto">••••••</p></div>
      </div>
      <h3>Todas as Reservas</h3>
      <table id="tabelaReservas">
        <tr>
          <th>Cliente</th><th>Data</th><th>Hora</th><th>Pessoas</th><th>Mesa</th><th>Valor</th><th>Pag.</th><th>Antecipado</th><th>Status</th><th>Ações</th>
        </tr>
      </table>
    </div>

    <!-- NOVA RESERVA -->
    <div id="reserva" style="display: none;">
      <div class="form-panel">
        <h3>Nova Reserva</h3>
        <div class="form-row">
          <div class="form-group"><label>Cliente:</label><input type="text" id="cliente"></div>
          <div class="form-group"><label>Data:</label><input type="date" id="data"></div>
          <div class="form-group"><label>Hora:</label><input type="time" id="hora"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Pessoas:</label><input type="number" id="pessoas" min="1"></div>
          <div class="form-group"><label>Mesa:</label><input type="text" id="mesa"></div>
          <div class="form-group"><label>Valor (R$):</label><input type="text" id="valor"></div>
          <div class="form-group">
            <label>Forma de Pagamento:</label>
            <select id="pagamento">
              <option value="">Selecione</option>
              <option value="Pix">Pix</option>
              <option value="Cartão">Cartão</option>
              <option value="Dinheiro">Dinheiro</option>
            </select>
          </div>
        </div>
        <div class="checkbox-group">
          <label>Pagamento Antecipado</label>
          <input type="checkbox" id="antecipado" onchange="toggleAntecipadoValor()">
        </div>
        <div id="valorAntecipadoDiv">
          <label>Valor do Pagamento Antecipado (R$):</label>
          <input type="text" id="valorAntecipado">
        </div>
        <div class="form-group">
          <label>Observações:</label>
          <textarea id="obs"></textarea>
        </div>
        <button onclick="salvarOuEditar()">Salvar</button>
        <input type="hidden" id="clienteOriginal">
      </div>
    </div>
  </div>
</div>

<script>
const URL_SCRIPT = 'https://script.google.com/macros/s/AKfycbwZrQMUe5dhWctefkH2qH-bPfe8zPz7irXlZNDk_U_shU18HZu2RXZkjdANZ6nNGi8/exec';

let valoresVisiveis = false;
let realTotalReservas = 0, realTotalFuturas = 0, realTotalAntecipado = 0, realValorTotal = 0, realTotalGeral = 0, realValorBruto = 0;

function showSection(section) {
  document.getElementById('dashboard').style.display = section === 'dashboard' ? 'block' : 'none';
  document.getElementById('reserva').style.display = section === 'reserva' ? 'block' : 'none';
  document.getElementById('link-dashboard').classList.toggle('active', section === 'dashboard');
  document.getElementById('link-reserva').classList.toggle('active', section === 'reserva');
}

function toggleAll() {
  document.getElementById('totalReservas').innerText = valoresVisiveis ? '••••••' : realTotalReservas;
  document.getElementById('totalFuturas').innerText = valoresVisiveis ? '••••••' : realTotalFuturas;
  document.getElementById('totalGeral').innerText = valoresVisiveis ? '••••••' : realTotalGeral;
  document.getElementById('totalAntecipado').innerText = valoresVisiveis ? '••••••' : "R$ " + realTotalAntecipado.toFixed(2);
  document.getElementById('valorTotal').innerText = valoresVisiveis ? '••••••' : "R$ " + realValorTotal.toFixed(2);
  document.getElementById('valorBruto').innerText = valoresVisiveis ? '••••••' : "R$ " + realValorBruto.toFixed(2);
  valoresVisiveis = !valoresVisiveis;
}

function toggleAntecipadoValor() {
  document.getElementById('valorAntecipadoDiv').style.display = document.getElementById('antecipado').checked ? 'block' : 'none';
}

function listarReservas() {
  const fi = document.getElementById('filtroDataInicial').value;
  const ff = document.getElementById('filtroDataFinal').value;
  const fs = document.getElementById('filtroStatus').value;

  fetch(URL_SCRIPT).then(r => r.json()).then(data => {
    let hoje = new Date().toISOString().slice(0,10);
    let tHoje=0,tFut=0,tAnte=0,vTotal=0,tGeral=0,vBruto=0;

    const tabela = document.getElementById('tabelaReservas');
    tabela.innerHTML = `<tr><th>Cliente</th><th>Data</th><th>Hora</th><th>Pessoas</th><th>Mesa</th><th>Valor</th><th>Pag.</th><th>Antecipado</th><th>Status</th><th>Ações</th></tr>`;

    data.forEach(row=>{
      const dr = row[2]?.substring(0,10) || '';
      if (fi && dr < fi) return; if (ff && dr > ff) return; if (fs && row[11] != fs) return;
      const val = parseFloat(row[6] || 0);
      const ant = row[8]==="Sim"?parseFloat(row[9]||0):0;
      const rest = val-ant;

      const tr = tabela.insertRow();
      tr.insertCell(0).innerText = row[1]; tr.insertCell(1).innerText = dr;
      tr.insertCell(2).innerText = row[3]; tr.insertCell(3).innerText = row[4];
      tr.insertCell(4).innerText = row[5]; tr.insertCell(5).innerText = "R$ "+val.toFixed(2);
      tr.insertCell(6).innerText = row[7]; tr.insertCell(7).innerText = ant?"Sim - R$ "+ant.toFixed(2):"Não";
      tr.insertCell(8).innerText = row[11];
      let acoes = `<button class="btn btn-edit" onclick="editarReserva('${row[1]}')">Editar</button>`;
      if (row[11]==="Pendente") acoes+=` <button class="btn btn-liquidar" onclick="liquidarReserva('${row[1]}')">Liquidar</button>`;
      if (row[11]==="Concluída") acoes+=` <button class="btn btn-reabrir" onclick="reabrirReserva('${row[1]}')">Reabrir</button>`;
      tr.insertCell(9).innerHTML = acoes;

      vBruto+=val; vTotal+=rest; tAnte+=ant; tGeral++;
      if (dr===hoje) tHoje++; else tFut++;
    });

    realTotalReservas=tHoje; realTotalFuturas=tFut; realTotalAntecipado=tAnte; realValorTotal=vTotal; realTotalGeral=tGeral; realValorBruto=vBruto;
    toggleAll();
  });
}

listarReservas();
</script>

</body>
</html>
